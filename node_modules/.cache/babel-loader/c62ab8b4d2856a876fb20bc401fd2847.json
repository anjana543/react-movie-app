{"ast":null,"code":"import _objectSpread from\"C:\\\\Projects\\\\dg-react-test\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\objectSpread2.js\";import _toConsumableArray from\"C:\\\\Projects\\\\dg-react-test\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\toConsumableArray.js\";import _slicedToArray from\"C:\\\\Projects\\\\dg-react-test\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import React,{useState,useEffect,useRef,useCallback}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import GridItem from\"../components/GridItem\";import useFetch from\"../hooks/useFetch\";import{updateHeader,updateMovieData}from\"../store/actions\";import{API}from\"../utils/constant\";import Loader from\"../components/Loader\";import ErrorBlock from\"../components/ErrorBlock\";import{filterDataByName,setKeyWithIndex}from\"../utils\";/**\r\n *  @description - Movie List View Page.\r\n *  @returns {Node} - Returns Movie List.\r\n */import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var MovieList=function MovieList(){var dispatch=useDispatch();var _useState=useState(1),_useState2=_slicedToArray(_useState,2),pageNumber=_useState2[0],setPageNumber=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),list=_useState4[0],setList=_useState4[1];var _useSelector=useSelector(function(state){return state;}),movieData=_useSelector.movieData,searchData=_useSelector.searchData;var _useFetch=useFetch(API.PAGE,pageNumber),data=_useFetch.data,hasMore=_useFetch.hasMore,loading=_useFetch.loading,error=_useFetch.error;useEffect(function(){if(data){var _data$contentItems;var pageItems=(data===null||data===void 0?void 0:(_data$contentItems=data[\"content-items\"])===null||_data$contentItems===void 0?void 0:_data$contentItems.content)||[];dispatch(updateHeader({title:(data===null||data===void 0?void 0:data.title)||\"\"}));dispatch(updateMovieData(pageItems));var updatedList=[].concat(_toConsumableArray(list),_toConsumableArray(pageItems));var filteredList=searchData!==null&&searchData!==void 0&&searchData.term?filterDataByName(searchData.term,updatedList):updatedList;setList(filteredList);}},[data]);var observer=useRef();var lastElementRef=useCallback(function(node){if(loading)return;if(observer.current)observer.current.disconnect();observer.current=new IntersectionObserver(function(entries){if(entries[0].isIntersecting&&hasMore){setPageNumber(function(prevPageNumber){return prevPageNumber+1;});}});if(node)observer.current.observe(node);},[loading,hasMore]);useEffect(function(){if(searchData!==null&&searchData!==void 0&&searchData.term){var updatedList=filterDataByName(searchData===null||searchData===void 0?void 0:searchData.term,movieData);setList(updatedList);}else{setList(movieData);}},[searchData]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"w-full p-4 grid gap-4 grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 xl:grid-cols-10 2xl:grid-cols-12\",children:[list.map(function(item,index){return/*#__PURE__*/_jsx(\"div\",_objectSpread(_objectSpread({className:\"min-w-full\"},list.length===index+1&&{ref:lastElementRef}),{},{\"data-testid\":\"movie-item\",children:/*#__PURE__*/_jsx(GridItem,{item:item})}),setKeyWithIndex(item.name,index));}),loading&&/*#__PURE__*/_jsx(Loader,{})]}),!loading&&list.length===0&&/*#__PURE__*/_jsx(ErrorBlock,{title:\"Error!\",subTitle:\"Something went wrong.\"})]});};export default MovieList;","map":{"version":3,"sources":["C:/Projects/dg-react-test/src/pages/MovieList.js"],"names":["React","useState","useEffect","useRef","useCallback","useDispatch","useSelector","GridItem","useFetch","updateHeader","updateMovieData","API","Loader","ErrorBlock","filterDataByName","setKeyWithIndex","MovieList","dispatch","pageNumber","setPageNumber","list","setList","state","movieData","searchData","PAGE","data","hasMore","loading","error","pageItems","content","title","updatedList","filteredList","term","observer","lastElementRef","node","current","disconnect","IntersectionObserver","entries","isIntersecting","prevPageNumber","observe","map","item","index","length","ref","name"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport GridItem from \"../components/GridItem\";\r\nimport useFetch from \"../hooks/useFetch\";\r\nimport { updateHeader, updateMovieData } from \"../store/actions\";\r\nimport { API } from \"../utils/constant\";\r\nimport Loader from \"../components/Loader\";\r\nimport ErrorBlock from \"../components/ErrorBlock\";\r\nimport { filterDataByName, setKeyWithIndex } from \"../utils\";\r\n\r\n/**\r\n *  @description - Movie List View Page.\r\n *  @returns {Node} - Returns Movie List.\r\n */\r\nconst MovieList = () => {\r\n  const dispatch = useDispatch();\r\n  const [pageNumber, setPageNumber] = useState(1);\r\n  const [list, setList] = useState([]);\r\n  const { movieData, searchData } = useSelector((state) => state);\r\n\r\n  const { data, hasMore, loading, error } = useFetch(API.PAGE, pageNumber);\r\n\r\n  useEffect(() => {\r\n    if (data) {\r\n      const pageItems = data?.[\"content-items\"]?.content || [];\r\n      dispatch(updateHeader({ title: data?.title || \"\" }));\r\n      dispatch(updateMovieData(pageItems));\r\n      const updatedList = [...list, ...pageItems];\r\n      let filteredList = searchData?.term\r\n        ? filterDataByName(searchData.term, updatedList)\r\n        : updatedList;\r\n      setList(filteredList);\r\n    }\r\n  }, [data]);\r\n\r\n  const observer = useRef();\r\n  const lastElementRef = useCallback(\r\n    (node) => {\r\n      if (loading) return;\r\n      if (observer.current) observer.current.disconnect();\r\n      observer.current = new IntersectionObserver((entries) => {\r\n        if (entries[0].isIntersecting && hasMore) {\r\n          setPageNumber((prevPageNumber) => prevPageNumber + 1);\r\n        }\r\n      });\r\n      if (node) observer.current.observe(node);\r\n    },\r\n    [loading, hasMore]\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (searchData?.term) {\r\n      const updatedList = filterDataByName(searchData?.term, movieData);\r\n      setList(updatedList);\r\n    } else {\r\n      setList(movieData);\r\n    }\r\n  }, [searchData]);\r\n\r\n  return (\r\n    <>\r\n      <div className=\"w-full p-4 grid gap-4 grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 xl:grid-cols-10 2xl:grid-cols-12\">\r\n        {list.map((item, index) => {\r\n          return (\r\n            <div\r\n              key={setKeyWithIndex(item.name, index)}\r\n              className=\"min-w-full\"\r\n              {...(list.length === index + 1 && {\r\n                ref: lastElementRef,\r\n              })}\r\n              data-testid=\"movie-item\"\r\n            >\r\n              <GridItem item={item} />\r\n            </div>\r\n          );\r\n        })}\r\n        {loading && <Loader />}\r\n      </div>\r\n      {!loading && list.length === 0 && (\r\n        <ErrorBlock title=\"Error!\" subTitle=\"Something went wrong.\" />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default MovieList;\r\n"]},"metadata":{},"sourceType":"module"}